# اختبارات التكامل مع البيانات الحقيقية - AION MCP Agent

## نظرة عامة

هذا الدليل يوضح كيفية تشغيل اختبارات شاملة للتأكد من أن النظام يحقق التكامل مع البيانات الحقيقية من العقود الذكية والبروتوكولات الخارجية.

## 🎯 أهداف الاختبار

- **التحقق من التكامل الحقيقي**: التأكد من أن النظام يتعامل مع بيانات حقيقية وليس بيانات وهمية
- **اختبار الأداء**: قياس الأداء تحت الضغط مع البيانات الحقيقية
- **التحقق من الاستقرار**: التأكد من أن النظام مستقر أثناء التعامل مع APIs الخارجية
- **اختبار التعافي من الأخطاء**: التأكد من أن النظام يتعامل مع فشل APIs بشكل صحيح

## 📁 ملفات الاختبار

### 1. اختبارات التكامل مع البيانات الحقيقية
```
tests/integration/real-data-integration.test.js
```
**الوظائف**:
- اختبار الاتصال بشبكات البلوكتشين الحقيقية
- اختبار جلب بيانات السوق الحقيقية من Binance و DeFiLlama
- اختبار قراءة حالة العقود الذكية الحقيقية
- اختبار خدمة Oracle مع مصادر بيانات متعددة

### 2. اختبارات التحقق من العقود الذكية
```
tests/integration/smart-contract-validation.test.js
```
**الوظائف**:
- اختبار قراءة حالة العقود الحقيقية (Venus, PancakeSwap, BUSD)
- التحقق من صحة بيانات البروتوكولات
- اختبار مصادر البيانات المختلفة
- التحقق من اتساق البيانات عبر البروتوكولات

### 3. اختبارات الأداء تحت الضغط
```
tests/performance/real-data-stress.test.js
```
**الوظائف**:
- اختبار الأداء مع الطلبات المتزامنة
- اختبار استخدام الذاكرة تحت الضغط
- اختبار معدل الأخطاء تحت الحمل العالي
- اكتشاف تدهور الأداء

### 4. اختبارات التكامل الشاملة
```
tests/integration/comprehensive-integration.test.js
```
**الوظائف**:
- اختبار جميع الخدمات معاً
- اختبار سير العمل الكامل للمستخدم
- اختبار الاستقرار مع المستخدمين المتزامنين
- مراقبة النظام والمقاييس

## 🚀 تشغيل الاختبارات

### المتطلبات الأساسية
```bash
# التأكد من تثبيت التبعيات
npm install

# التأكد من وجود ملف .env مع الإعدادات الصحيحة
cp .env.example .env
# تعديل .env مع القيم الصحيحة
```

### تشغيل اختبارات محددة

```bash
# اختبارات التكامل مع البيانات الحقيقية
npm run test:real-data

# اختبارات التحقق من العقود الذكية
npm run test:smart-contracts

# اختبارات الأداء تحت الضغط
npm run test:stress

# اختبارات التكامل الشاملة
npm run test:comprehensive
```

### تشغيل جميع الاختبارات
```bash
# تشغيل جميع الاختبارات
npm run test:all

# تشغيل مع تقرير التغطية
npm run test:coverage

# تشغيل في وضع المراقبة
npm run test:watch
```

## 📊 معايير الأداء

### معايير الأداء المستهدفة
| الاختبار | المعيار | الوصف |
|----------|---------|--------|
| طلب واحد | < 2 ثانية | طلب API واحد يجب أن يكتمل خلال ثانيتين |
| 10 طلبات متزامنة | < 5 ثوان | 10 طلبات متزامنة يجب أن تكتمل خلال 5 ثوان |
| 50 طلب متزامن | < 15 ثانية | 50 طلب متزامن يجب أن يكتمل خلال 15 ثانية |
| ضربة التخزين المؤقت | < 100 مللي ثانية | استرجاع البيانات من التخزين المؤقت يجب أن يكون سريع |
| استخدام الذاكرة | < 512 ميجابايت | استخدام الذاكرة يجب أن يبقى تحت 512 ميجابايت |
| معدل الأخطاء | < 10% | معدل الأخطاء يجب أن يكون أقل من 10% |

### معايير جودة البيانات
- **اكتمال البيانات**: > 80% من البروتوكولات يجب أن تحتوي على بيانات كاملة
- **حداثة البيانات**: > 50% من البيانات يجب أن تكون حديثة (أقل من 5 دقائق)
- **دقة الأسعار**: أسعار BNB يجب أن تكون بين $100 و $10,000
- **نطاق APY**: APY يجب أن يكون بين 0.1% و 1000%

## 🔍 ما يتم اختباره

### 1. التكامل مع APIs الخارجية
- **Binance API**: جلب أسعار BNB الحقيقية
- **DeFiLlama API**: جلب بيانات البروتوكولات
- **Venus Protocol API**: جلب بيانات Venus المباشرة
- **PancakeSwap API**: جلب بيانات PancakeSwap

### 2. التكامل مع البلوكتشين
- **BSC Mainnet**: الاتصال بشبكة BSC الرئيسية
- **BSC Testnet**: الاتصال بشبكة BSC التجريبية
- **قراءة العقود**: قراءة حالة العقود الذكية الحقيقية
- **تقدير الغاز**: تقدير تكلفة الغاز للمعاملات

### 3. إدارة البيانات
- **التخزين المؤقت**: اختبار أداء التخزين المؤقت
- **مصادر البيانات**: التحقق من مصادر البيانات المختلفة
- **حداثة البيانات**: التأكد من أن البيانات حديثة
- **اتساق البيانات**: التحقق من اتساق البيانات عبر الطلبات

### 4. الأداء والاستقرار
- **الطلبات المتزامنة**: اختبار الأداء مع الطلبات المتزامنة
- **استخدام الذاكرة**: مراقبة استخدام الذاكرة تحت الضغط
- **معدل الأخطاء**: قياس معدل الأخطاء تحت الحمل
- **الاستقرار**: التأكد من استقرار النظام على المدى الطويل

## ⚠️ ملاحظات مهمة

### 1. الاعتماد على الشبكة
- بعض الاختبارات تعتمد على اتصال الإنترنت
- قد تفشل الاختبارات إذا كانت APIs الخارجية غير متاحة
- النظام مصمم للتعامل مع فشل APIs بشكل صحيح

### 2. حدود المعدل
- بعض APIs لديها حدود معدل للطلبات
- الاختبارات مصممة لتجنب تجاوز حدود المعدل
- قد تحتاج لتعديل فترات الانتظار بين الطلبات

### 3. البيانات الحقيقية
- جميع الاختبارات تستخدم بيانات حقيقية
- لا توجد بيانات وهمية أو fallback data
- الأسعار والقيم تتغير باستمرار

## 🐛 استكشاف الأخطاء

### مشاكل شائعة

#### 1. فشل الاتصال بالشبكة
```bash
# التحقق من الاتصال بالإنترنت
ping google.com

# التحقق من إعدادات .env
cat .env | grep RPC
```

#### 2. فشل APIs الخارجية
```bash
# اختبار Binance API
curl https://api.binance.com/api/v3/ticker/price?symbol=BNBUSDT

# اختبار DeFiLlama API
curl https://api.llama.fi/protocols
```

#### 3. مشاكل الذاكرة
```bash
# زيادة حد الذاكرة لـ Node.js
node --max-old-space-size=4096 tests/performance/real-data-stress.test.js
```

### وضع التصحيح
```bash
# تشغيل اختبار واحد مع تفاصيل أكثر
npm test -- --verbose tests/integration/real-data-integration.test.js

# تشغيل مع تقرير مفصل
npm test -- --detectOpenHandles --forceExit
```

## 📈 تقارير الأداء

### توليد تقرير الأداء
```bash
# تشغيل اختبارات الأداء مع التقرير
npm run test:stress -- --reporters=verbose

# حفظ النتائج في ملف
npm run test:stress > performance-report.txt 2>&1
```

### تحليل النتائج
- **وقت الاستجابة**: يجب أن يكون أقل من المعايير المستهدفة
- **معدل النجاح**: يجب أن يكون أعلى من 90%
- **استخدام الذاكرة**: يجب أن يبقى مستقراً
- **معدل الأخطاء**: يجب أن يكون أقل من 10%

## 🔄 التحديثات والصيانة

### تحديث الاختبارات
- مراجعة معايير الأداء كل شهر
- تحديث عناوين العقود الذكية عند الحاجة
- إضافة اختبارات للبروتوكولات الجديدة
- تحديث حدود المعدل للـ APIs

### مراقبة الأداء
- تشغيل الاختبارات بانتظام
- تتبع اتجاهات الأداء
- اكتشاف المشاكل مبكراً
- تحسين الأداء المستمر

## 📞 الدعم

إذا واجهت مشاكل في تشغيل الاختبارات:

1. **تحقق من الإعدادات**: تأكد من صحة ملف .env
2. **تحقق من الاتصال**: تأكد من الاتصال بالإنترنت
3. **تحقق من التبعيات**: تأكد من تثبيت جميع التبعيات
4. **راجع السجلات**: تحقق من سجلات الأخطاء
5. **تواصل مع الفريق**: إذا استمرت المشكلة

---

**ملاحظة**: هذه الاختبارات مصممة للتأكد من أن النظام يعمل مع البيانات الحقيقية 100% ولا يستخدم أي بيانات وهمية أو fallback data.
